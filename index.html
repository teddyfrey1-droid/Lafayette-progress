<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2563eb">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- IcÃ´nes PWA avec fusÃ©e ğŸš€ -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb'/%3E%3Cstop offset='50%25' style='stop-color:%238b5cf6'/%3E%3Cstop offset='100%25' style='stop-color:%23ec4899'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-family='Arial,sans-serif' font-size='55' fill='white' text-anchor='middle'%3EğŸš€%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb'/%3E%3Cstop offset='50%25' style='stop-color:%238b5cf6'/%3E%3Cstop offset='100%25' style='stop-color:%23ec4899'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-family='Arial,sans-serif' font-size='55' fill='white' text-anchor='middle'%3EğŸš€%3C/text%3E%3C/svg%3E">
  <link rel="manifest" href="manifest.webmanifest">
  
  <title>Heiko - Budget Master V61 (Animated Borders)</title>
  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

  <link rel="stylesheet" href="assets/css/styles.css">

  <!-- Typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

</head>
<body>

  <div class="theme-toggle" onclick="toggleDarkMode()">
    <div class="theme-toggle-slider"><span class="toggle-icon">â˜€ï¸</span></div>
  </div>

  <div id="topAlert">
      <div class="alert-icon">ğŸ“£</div>
      <div class="alert-content">
          <div class="alert-title">NOUVEAUTÃ‰ !</div>
          <div class="alert-desc" id="topAlertText">...</div>
      </div>
  </div>

  <div id="updatesModal" class="modal-overlay">
      <div class="modal-box">
          <div class="modal-title">
             <span>ğŸ“¢ DerniÃ¨res NouveautÃ©s</span>
             <button style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);" onclick="document.getElementById('updatesModal').style.display='none'">Ã—</button>
          </div>
          <div id="publicUpdatesList" style="display:flex; flex-direction:column; gap:10px;">
              <div style="text-align:center; color:#999;">Chargement...</div>
          </div>
      </div>
  <div id="historyModal" class="modal-overlay" style="display:none;">
      <div class="modal-box">
          <div class="modal-title">
             <span>ğŸ•’ Mon historique</span>
             <button style="border:none; background:none; font-size:24px; font-weight:900; cursor:pointer;" onclick="document.getElementById('historyModal').style.display='none'">Ã—</button>
          </div>
          <div style="font-size:12px; color:var(--text-muted); margin-bottom:10px;">RÃ©sumÃ© mensuel (primes dÃ©bloquÃ©es + % objectifs validÃ©s)</div>
          <div id="historyModalList" style="display:flex; flex-direction:column; gap:10px;">
              <div style="text-align:center; color:#999;">Chargement...</div>
          </div>
      </div>
  </div>

  </div>

  <!-- Archive mensuelle (Super Admin/Admin) : trace dans le temps par Ã©quipier -->
  <div id="teamArchiveModal" class="modal-overlay">
    <div class="modal-box" style="max-width:640px;">
      <div class="modal-title">
        <span>ğŸ“„ Archive mensuelle â€” <span id="teamArchiveName">â€”</span></span>
        <button style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);" onclick="closeTeamArchive()">Ã—</button>
      </div>
      <div style="font-size:12px; color:var(--text-muted); font-weight:700; margin-bottom:10px;">
        Valide une ligne en fin de mois (30/31) pour garder une trace, puis marque "EnvoyÃ©" si tu lui as partagÃ©.
      </div>
      <div id="teamArchiveList" style="display:flex; flex-direction:column; gap:10px;"></div>
      <div style="height:12px;"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn" id="btnArchiveThisMonth" onclick="archiveCurrentMonthForUser()">âœ… Archiver le mois en cours</button>
        <button class="btn" style="background:var(--border-color); color:var(--text-main);" onclick="addManualArchiveRow()">â• Ajouter un mois</button>
      </div>
    </div>
  </div>

  <!-- Suivi (graph) par objectif -->
  <div id="objectiveProgressModal" class="modal-overlay">
    <div class="modal-box" style="max-width:760px;">
      <div class="modal-title">
        <span>ğŸ“ˆ Suivi â€” <span id="objProgName">â€”</span></span>
        <button style="border:none; background:none; font-size:20px; cursor:pointer; color:var(--text-main);" onclick="closeObjectiveProgress()">Ã—</button>
      </div>
<div class="objprog-canvas-wrap">
      <canvas id="objProgCanvas" width="720" height="220" style="width:100%; border:1px solid var(--border-color); border-radius:14px; background:rgba(0,0,0,0.02);"></canvas>
      <div id="objProgTooltip" class="objprog-tooltip" style="display:none;"></div>
    </div>
      <div style="height:12px;"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
        <div style="flex:1; min-width:160px;">
          <div style="font-size:11px; font-weight:900; color:var(--text-muted); margin-bottom:6px;">DATE</div>
          <input type="date" id="objProgDate" />
        </div>
        <div style="flex:1; min-width:160px;">
          <div id="objProgValueLabel" style="font-size:11px; font-weight:900; color:var(--text-muted); margin-bottom:6px;">PROGRESSION (%)</div>
          <input type="number" id="objProgValue" placeholder="ex: 22" step="0.1" />
        </div>
        <button class="btn" style="width:auto; padding:12px 16px;" onclick="addObjectiveProgressPoint()">â• Ajouter</button>
      </div>
      <div style="height:14px;"></div>
      <div id="objProgList" style="display:flex; flex-direction:column; gap:10px;"></div>
    </div>
  </div>

  <div id="toast">âœ… Action effectuÃ©e avec succÃ¨s !</div>

  <div id="loginOverlay">
    <h1 style="font-size: 28px; font-weight: 900; color: var(--text-main); margin-bottom: 25px; text-transform: uppercase; text-align: center; line-height: 1.4;">ğŸš€ DASHBOARD SUIVI ğŸš€<br>LAFAYETTE</h1>
    
    <div class="login-box">
      <h2 class="login-title">Connexion Membre</h2>
      <div class="input-group">
          <input type="email" id="loginEmail" placeholder="Email" oninput="clearLoginError()">
      </div>
      <div class="input-group">
          <input type="password" id="loginPass" placeholder="Mot de passe" oninput="clearLoginError()">
          <span class="toggle-password" onclick="togglePass()">ğŸ‘ï¸</span>
      </div>
      <button class="btn" id="btnLogin">Connexion</button>
    </div>
  </div>

  <div id="appContent">
    <div class="top-bar">
      <div class="user-welcome">
        ğŸ‘¤ <span id="userName">--</span> 
        <span class="user-badge" id="userHours">--h</span>
      </div>
      <div class="top-actions">
              <button id="btnAdmin" class="btn admin-btn" style="display:none;"><span class="admin-icon" aria-hidden="true">âš™ï¸</span><span class="admin-text">Admin</span></button>
        <button id="logoutBtn" onclick="logout()" class="btn logout-btn" style="width:auto; padding:8px 16px; font-size:11px; background:var(--card-bg); color:#ef4444; border:1px solid #fca5a5;">
          <span class="logout-icon" aria-hidden="true">ğŸšª</span>
          <span class="logout-text">DÃ©connexion</span>
        </button>

        <button class="icon-btn" id="globalMenuBtn" onclick="toggleGlobalMenu()">â˜°</button>
      </div>
    </div>

    <!-- Global menu (all users) -->
    <div class="global-menu-backdrop" id="globalMenuBackdrop" onclick="toggleGlobalMenu(false)"></div>
    <aside class="global-menu" id="globalMenu" aria-label="Menu">
      <div class="global-menu-head">
        <div class="global-menu-title">Menu</div>
        <button class="icon-btn" type="button" onclick="toggleGlobalMenu(false)" aria-label="Fermer">Ã—</button>
      </div>
      <nav class="global-menu-links">
        <a class="global-menu-link menu-dashboard" href="index.html#dashboard" onclick="toggleGlobalMenu(false)"><span class="menu-dashboard-label">ğŸ“Š Dashboard</span></a>
        <button class="global-menu-link" type="button" onclick="openUpdatesModalFromMenu()">
          <span>ğŸ“° NouveautÃ©s</span>
          <span style="opacity:.55; font-weight:900;">â€º</span>
        </button>

        <button class="global-menu-link" type="button" onclick="openHistoryModalFromMenu()">
          <span>ğŸ•’ Mon historique</span>
          <span style="opacity:.55; font-weight:900;">â€º</span>
        </button>
        <div class="global-menu-sep" aria-hidden="true"></div>
        <!-- 2 catÃ©gories sÃ©parÃ©es : Sites utiles puis Contacts (1 seule ouverte Ã  la fois) -->
        <button class="global-menu-link global-menu-accordion" type="button" onclick="toggleMenuSites()">
          <span>ğŸ”— Sites utiles</span>
          <span id="menuSitesChev" class="menu-chev" aria-hidden="true">â–¸</span>
        </button>
        <div class="global-menu-sub" id="menuSitesSub" style="display:none;">
          <div class="menu-sub-head">
            <div class="menu-sub-title">ğŸ”— Sites utiles</div>
            <a class="menu-sub-link" href="contacts.html#sites" onclick="toggleGlobalMenu(false)">Voir tout</a>
          </div>
          <div class="menu-preview-grid" id="menuSitesPreview"></div>
        </div>

        
        <button class="global-menu-link global-menu-accordion" type="button" onclick="toggleMenuSuppliers()">
          <span>ğŸ“¦ Contact fournisseurs</span>
          <span id="menuSuppliersChev" class="menu-chev" aria-hidden="true">â–¸</span>
        </button>
        <div class="global-menu-sub" id="menuSuppliersSub" style="display:none;">
          <div class="menu-sub-head">
            <div class="menu-sub-title">ğŸ“¦ Contact fournisseurs</div>
            <a class="menu-sub-link" href="contacts.html#fournisseurs" onclick="toggleGlobalMenu(false)">Voir tout</a>
          </div>
          <div class="menu-preview-grid" id="menuSuppliersPreview"></div>
        </div>

<button class="global-menu-link global-menu-accordion" type="button" onclick="toggleMenuContacts()">
          <span>ğŸ“ Contacts</span>
          <span id="menuContactsChev" class="menu-chev" aria-hidden="true">â–¸</span>
        </button>
        <div class="global-menu-sub" id="menuContactsSub" style="display:none;">
          <div class="menu-sub-head">
            <div class="menu-sub-title">ğŸ“ Contacts</div>
            <a class="menu-sub-link" href="contacts.html#contacts" onclick="toggleGlobalMenu(false)">Voir tout</a>
          </div>
          <div class="menu-preview-grid" id="menuContactsPreview"></div>
        </div>
      </nav>
      <div class="global-menu-foot">
        <button id="installAppBtn" class="btn" style="width:100%; margin-top:10px; display:none;">â¬‡ï¸ Installer l'app</button>
      </div>
    </aside>

    <div class="container">
      <header id="dashboard">
        <div class="header-pill">ğŸš€ Dashboard Live</div>
        <h1>OBJECTIFS HEIKO LAFAYETTE</h1>
        <div class="last-update" id="lastUpdate">Chargement...</div>
        
        <div class="global-score-container" id="scoreCircle">
          <div class="money-rain" id="moneyRain"></div>
          <div class="global-score-value" id="myTotalGain">0â‚¬</div>
          <div class="global-score-label" id="globalScoreLabel">MES PRIMES<br>DÃ‰BLOQUÃ‰ES</div>
          <div class="global-score-pills">
            <div class="global-score-pill" id="pendingGain">â³ 0â‚¬ en attente</div>
          </div>
          <div class="global-score-micro" id="microMotiv">â€”</div>
        </div>

        <!-- Phase 1: trajectoire + micro feedback journalier (sous le cercle) -->
        <div class="trajectory-indicator" id="trajectoryIndicator" aria-label="Trajectoire du mois">â€”</div>
        <div class="daily-micro" id="dailyMicro" aria-label="Message du jour">â€”</div>

        <!-- Compteur fin de mois (Ã  la seconde, sous le cercle) -->
        <div class="month-countdown" id="monthCountdown" aria-label="Temps restant avant la fin du mois">â€”</div>
      </header>
      

      <section class="kpi-strip" id="kpiStrip" aria-label="Indicateurs clÃ©s">
        <div class="kpi-card">
          <div class="kpi-label">Mes primes</div>
          <div class="kpi-value" id="kpiMyGain">0â‚¬</div>
          <div class="kpi-sub">DÃ©bloquÃ©es</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Objectifs actifs</div>
          <div class="kpi-value" id="kpiActiveObjs">0</div>
          <div class="kpi-sub">PubliÃ©s</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Bonus</div>
          <div class="kpi-value" id="kpiBonusState">â€”</div>
          <div class="kpi-sub" id="kpiBonusSub">â€”</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Mise Ã  jour</div>
          <div class="kpi-value" id="kpiUpdated">â€”</div>
          <div class="kpi-sub">Aujourd'hui</div>
        </div>
      </section>

      



      <div class="focus-pill" id="focusPill" aria-label="Focus du jour">
        <span class="focus-emoji" id="focusEmoji">ğŸ”¥</span>
        <span class="focus-text" id="focusText">Chargement...</span>
      </div>

      <div class="objectives-wrapper" id="cardsContainer">
        <div style="text-align:center; color:#9ca3af; margin-top:50px;">Chargement des donnÃ©es...</div>
      </div>

      <div class="category-title planning-title" style="margin-top:60px;">Planning ğŸ“…</div>

      <div class="native-cal-container" style="margin-top:20px;">
          <div class="cal-header">
             <button class="cal-nav-btn" onclick="prevMonth()">â®</button>
             <div class="cal-month-title" id="calTitle">DÃ‰CEMBRE 2025</div>
             <button class="cal-nav-btn" onclick="nextMonth()">â¯</button>
          </div>
          <div class="cal-grid" style="margin-bottom:10px;">
             <div class="cal-day-name">LUN</div><div class="cal-day-name">MAR</div><div class="cal-day-name">MER</div><div class="cal-day-name">JEU</div><div class="cal-day-name">VEN</div><div class="cal-day-name">SAM</div><div class="cal-day-name">DIM</div>
          </div>
          <div class="cal-grid" id="calGrid"></div>
          <div class="cal-legend" id="calLegend"></div>
      </div>
    </div>
  </div>


      <div class="section-block" id="quick-directory">
        <div class="section-title" style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <span>Contacts &amp; Sites utiles</span>
          <button class="icon-btn" id="sitesMiniToggle" type="button" aria-label="AperÃ§u des sites" onclick="toggleSitesMini()">â–¾</button>
        </div>
        <div class="section-card" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <div>
            <div class="section-muted">Page dÃ©diÃ©e (rapide) pour tout retrouver.</div>
          </div>
          <a class="btn" href="contacts.html" style="width:auto; padding:12px 16px;">Ouvrir</a>
        </div>

        <!-- AperÃ§u rapide (dashboard) : clic sur la flÃ¨che â–¾ -->
        <div id="sitesMiniPanel" class="sites-mini-panel" style="display:none;">
          <div class="sites-mini-head">
            <div class="sites-mini-title">ğŸ”— Sites utiles</div>
            <a class="sites-mini-all" href="contacts.html" aria-label="Voir tous les sites">Voir tout</a>
          </div>
          <div id="sitesMiniRow" class="sites-mini-row" aria-label="AperÃ§u sites utiles"></div>
        </div>

        <!-- Raccourcis en bas (cartes) -->
        <div id="sitesBottomRow" class="sites-bottom-row" aria-label="Raccourcis sites"></div>
      </div>

  <div class="admin-panel" id="adminPanel">
    <button class="close-admin" onclick="toggleAdmin(false)">Ã—</button>
    <h2 style="margin-bottom:20px;">Panneau Manager</h2>
    
    <div class="tab-nav">
      <button id="btnTabTeam" onclick="switchTab('team')" class="btn-tab active">ğŸ‘¥ Ã‰quipe</button>
      <button id="btnTabEmails" onclick="switchTab('emails')" class="btn-tab" style="display:none;">ğŸ“§ Mail</button>
      <button id="btnTabPush" onclick="switchTab('push')" class="btn-tab" style="display:none;">ğŸ“± Push</button>
      <button id="btnTabObjs" onclick="switchTab('objs')" class="btn-tab">ğŸ¯ Pilotage</button>
      <button id="btnTabLogs" onclick="switchTab('logs')" class="btn-tab" style="display:none;">ğŸ•’ Historique</button>
      <button id="btnTabFeedbacks" onclick="switchTab('feedbacks')" class="btn-tab" style="display:none;">ğŸ’¬ Avis & NouveautÃ©s</button>
    </div>

    <div id="tab-team">
      <div class="admin-section">
        <h3 class="section-header-large">Ajouter un Membre</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <input type="text" id="nuName" placeholder="PrÃ©nom">
          <input type="number" id="nuHours" placeholder="Heures">
        </div>
        <input type="email" id="nuEmail" placeholder="Email">
        <div style="margin-bottom:10px; margin-top:10px;"><input type="checkbox" id="nuAdmin" style="width:auto; vertical-align:middle;"> <label style="font-size:12px;">Admin ?</label></div>
        <button class="btn" onclick="createUser()">CrÃ©er le membre</button>
      </div>
      <div class="admin-section">
        <h3 class="section-header-large">Effectif & Primes</h3>
        <div id="usersList"></div>
      </div>
    

    </div>

    <div id="tab-emails" style="display:none;">
      <div class="admin-section">
        <h3 class="section-header-large">ğŸ“§ Envoyer un email</h3>

        <div class="mail-settings-row">
          <div class="mail-settings-field">
            <label class="mail-label">RÃ©gion Firebase Functions (optionnel)</label>
            <input type="text" id="mailFunctionsRegion" placeholder="Ex: us-central1 ou europe-west1">
            <div class="mail-hint">Si ton Cloud Function est dÃ©ployÃ©e dans une rÃ©gion spÃ©cifique, renseigne-la ici. Sinon laisse vide.</div>
          </div>
          <div class="mail-settings-field">
            <label class="mail-label">Nom affichÃ© (optionnel)</label>
            <input type="text" id="mailFromName" placeholder="Ex: Heiko La Fayette">
            <div class="mail-hint">UtilisÃ© uniquement si ta function le supporte.</div>
          </div>
          <div class="mail-settings-actions">
            <button class="btn" onclick="saveMailSettings()">ğŸ’¾ Enregistrer</button>
          </div>
        </div>

        <div style="margin-top:18px;">
          <div class="mail-label" style="margin-bottom:8px;">Groupes rapides</div>
          <div id="mailQuickGroups" class="mail-quick-groups"></div>
        </div>

        <div style="margin-top:18px;">
          <div class="mail-label" style="margin-bottom:8px;">Destinataires</div>
          <div id="mailUsersGrid" class="mail-users-grid"></div>
          <div id="mailSelectedCount" class="mail-selected-count">0 destinataire(s) sÃ©lectionnÃ©(s)</div>
        </div>

        <div style="margin-top:18px;">
          <label class="mail-label">Sujet</label>
          <input type="text" id="mailSubject" placeholder="Ex : Planning de la semaine">

          <label class="mail-label" style="margin-top:10px;">Message</label>
          <textarea id="mailMessage" rows="8" placeholder="Ã‰cris ton messageâ€¦ (HTML acceptÃ©)"></textarea>

          <div class="mail-actions">
            <button class="btn" onclick="sendManualEmail()">ğŸ“¤ Envoyer</button>
            <button class="btn" onclick="clearMailSelection()" style="background:#e2e8f0; color:#475569; border:1px solid #cbd5e1;">â†©ï¸ RÃ©initialiser</button>
          </div>
          <div class="mail-hint" style="margin-top:10px;">
            Pour l'envoi rÃ©el, il faut dÃ©ployer une Cloud Function. Le dossier <code>functions/</code> est inclus dans ce projet.
          </div>
        </div>
      </div>

      <div class="admin-section">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <h3 class="section-header-large" style="margin:0;">ğŸ‘¥ Groupes mail</h3>
          <button class="btn" onclick="openMailGroupModal()" style="width:auto;">â• Nouveau groupe</button>
        </div>
        <div id="mailGroupsList" style="margin-top:12px;"></div>
      </div>

      <div class="admin-section" style="border-left:4px solid #f59e0b;">
        <h3 class="section-header-large" style="color:#b45309;">âš¡ Automatisation (prÃ©parÃ©)</h3>
        <div class="mail-hint">
          Le systÃ¨me est prÃªt pour des envois automatiques (ex: quand le planning change) via une Function trigger.

          Le schÃ©ma du planning n'est pas dÃ©fini dans ce projet, donc le trigger est fourni en modÃ¨le dans <code>functions/index.js</code> (Ã  adapter Ã  ta structure).
        </div>
      </div>
    </div>

  <!-- ==================== ONGLET PUSH ==================== -->
  <div id="tab-push" style="display:none;">
    <div class="admin-section">

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <h2 style="margin:0;">ğŸ“± Gestion des Notifications Push</h2>
      </div>

      <!-- Section 1: Liste des utilisateurs -->
      <div class="section-card" style="margin-bottom:20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:20px;">
        <h3 style="margin-top:0;font-size:16px;color:var(--primary);">ğŸ‘¥ Statut des notifications par utilisateur</h3>
        <div id="pushUsersList"></div>
      </div>

      <!-- Section 2: ParamÃ¨tres des alertes automatiques -->
      <div class="section-card" style="margin-bottom:20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:20px;">
        <h3 style="margin-top:0;font-size:16px;color:var(--primary);">âš™ï¸ Alertes automatiques</h3>
        <p style="font-size:13px;color:#94a3b8;margin-bottom:15px;">
          Configure quelles actions dÃ©clenchent une notification push automatique
        </p>
        <div id="pushSettings"></div>
      </div>

    </div>
  </div>

    <div id="tab-logs" style="display:none;">
      <div class="admin-section">
        <h3 class="section-header-large">ğŸ•’ ActivitÃ© par Utilisateur</h3>
        <div style="font-size:11px; color:#666; margin-bottom:15px;">Cliquez sur un nom pour voir le dÃ©tail <span style="font-size:10px;">â–¼</span></div>
        <div id="logsContainer" class="logs-wrapper"></div>
      </div>
    </div>
    
    <div id="tab-feedbacks" style="display:none;">
      
      <div class="admin-section" style="border-left:4px solid var(--accent);">
         <h3 class="section-header-large" style="color:var(--accent);">ğŸ“¢ GÃ©rer les NouveautÃ©s</h3>
         <div style="font-size:11px; color:#64748b; margin-bottom:10px;">Ajoutez, Modifiez ou Supprimez les annonces visibles par l'Ã©quipe.</div>
         
         <input type="hidden" id="uptId"> <input type="text" id="uptTitle" placeholder="Titre (ex: Nouveau Design)">
         <textarea id="uptDesc" class="fb-input" style="height:80px;" placeholder="Description des changements..."></textarea>
         <select id="uptType">
             <option value="new">âœ¨ NouveautÃ©</option>
             <option value="impr">ğŸ› ï¸ AmÃ©lioration</option>
             <option value="fix">ğŸ› Correction</option>
         </select>
         
         <div style="display:flex; gap:10px; margin-bottom:20px;">
             <button class="btn" id="btnSaveUpdate" onclick="saveUpdate()">Publier l'info</button>
             <button class="btn" id="btnCancelUpdate" onclick="cancelUpdateEdit()" style="background:#e2e8f0; color:#475569; display:none;">Annuler</button>
         </div>

         <div id="adminUpdatesList"></div>
      </div>

      <div class="admin-section">
        <h3 class="section-header-large">ğŸ’¬ Avis reÃ§us de l'Ã©quipe</h3>
        <div id="feedbacksContainer" class="logs-wrapper"></div>
      </div>
    </div>

    
    <div id="tab-objs" style="display:none;">
      
      <div class="admin-section" id="superAdminBudget" style="border: 2px solid var(--primary); display:block;">
         <h3 class="section-header-large">ğŸ›ï¸ PILOTAGE BUDGET & PRIMES</h3>
         
         <div class="cockpit-container">
            <div class="cockpit-top">
                <label class="budget-label-small">BUDGET MAX (â‚¬)</label>
                <div style="display:flex; align-items:center;">
                   <input type="number" id="simGlobalBudget" oninput="updateSim()">
                   <button id="btnSaveGlobalBudget" onclick="saveGlobalBudget()" style="border:none; background:var(--primary); color:white; padding:6px 10px; border-radius:6px; font-size:11px; margin-left:5px; cursor:pointer;">OK</button>
                </div>
            </div>
            
            <div class="cockpit-gauge-container">
                <div class="cockpit-gauge-fill" id="simGauge"></div>
            </div>
            <div class="cockpit-info">
                <span id="simUsed">0â‚¬ EngagÃ©s</span>
                <span id="simLeft">Reste : 0â‚¬</span>
            </div>

            <!-- Phase 2: Simulation CA + garde-fous (Super Admin uniquement) -->
            <div class="cockpit-top" style="margin-top:14px;">
              <label class="budget-label-small">SIMULATION CA MENSUEL (â‚¬)</label>
              <div style="display:flex; align-items:center; gap:8px;">
                <input type="number" id="simMonthlyCA" placeholder="Ex: 60000" oninput="updateSim()" style="max-width:160px;">
                <div class="user-badge" id="simPctCA" style="background:rgba(59,130,246,.12); color:var(--primary); border:1px solid rgba(59,130,246,.25);">â€”</div>
              </div>
            </div>

            <div class="cockpit-top" style="margin-top:10px;">
              <label class="budget-label-small">SEUIL ALERTE (% DU CA)</label>
              <div style="display:flex; align-items:center; gap:8px;">
                <input type="number" id="simGuardrailPct" placeholder="Ex: 20" min="1" max="100" style="max-width:90px;">
                <button id="btnSaveGuardrailPct" onclick="saveGuardrailMaxPct()" style="border:none; background:rgba(59,130,246,.14); color:var(--primary); padding:6px 10px; border-radius:6px; font-size:11px; font-weight:900; cursor:pointer;">OK</button>
                <div style="font-size:11px; color:var(--text-muted);">Admin</div>
              </div>
            </div>
            <div id="guardrailBox" class="section-card" style="padding:12px; display:none; border:1px solid rgba(239,68,68,.25); background:rgba(239,68,68,.06);">
              <div style="display:flex; align-items:flex-start; gap:10px;">
                <div style="font-size:18px; line-height:1;">âš ï¸</div>
                <div style="flex:1;">
                  <div style="font-weight:900; font-size:12px; text-transform:uppercase; letter-spacing:.08em;">Garde-fous</div>
                  <div id="guardrailText" style="margin-top:4px; font-size:12px; color:var(--text-main); line-height:1.35;">â€”</div>
                </div>
              </div>
            </div>
            
            <div id="simObjList" style="margin-top:20px;"></div>

            <div class="sim-total-box">
                <div class="sim-total-label">ğŸ’° PRIME TOTALE (POUR 1 EMPLOYÃ‰ 35H)</div>
                <div class="sim-total-value" id="simTotalPerUser">0â‚¬</div>
            </div>
         </div>

         <button class="btn" onclick="publishSim()" style="background:var(--success); margin-top:5px; font-size:13px; padding:12px;">ğŸ“¡ PUBLIER</button>
      </div>

      <div class="admin-section">
        <h3 style="font-size:14px; margin-bottom:10px;">ğŸ“¢ Publication</h3>
        <div id="pubList"></div>
      </div>
      
      <div class="admin-section">
        <h3 class="section-header-large" style="font-size:14px;">â• AJOUTER UN OBJECTIF</h3>
        <input type="text" id="noName" placeholder="Nom">
        <input type="text" id="noTarget" placeholder="Cible">
        
        <div class="options-row">
            <label class="check-label"><input type="checkbox" id="noPrimary" checked> âš¡ Principal</label>
            <label class="check-label"><input type="checkbox" id="noInverse"> ğŸ“‰ InversÃ©</label>
            <label class="check-label"><input type="checkbox" id="noNumeric"> ğŸ”¢ Nombre</label>
            <label class="check-label"><input type="checkbox" id="noFixed" onchange="toggleCreateInputs()"> ğŸ Fixe</label>
        </div>

        <div id="createTiersBlock">
            <div style="display:grid; grid-template-columns:1fr; gap:5px; margin-bottom:5px;">
                <label style="font-size:13px;font-weight:900; margin-bottom:5px; color:#1e293b;">Seuils (Montants dÃ©finis dans Pilotage)</label>
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                    <input type="number" id="c_p1t" placeholder="% P1">
                    <input type="number" id="c_p2t" placeholder="% P2">
                    <input type="number" id="c_p3t" placeholder="% P3">
                </div>
            </div>
        </div>

        <button class="btn" onclick="addObj()" style="margin-top:10px;">Ajouter</button>
      </div>
</div>
  </div>

  <div class="admin-panel" id="editUserPanel" style="z-index:2100; max-width:400px; border-left:4px solid #0ea5e9;">
    <h3 style="margin-bottom:15px; color:#0ea5e9;">Modifier Membre</h3>
    <input type="hidden" id="euId">
    <label style="font-size:11px; font-weight:700;">Nom</label><input type="text" id="euName">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
      <div><label style="font-size:11px; font-weight:700;">Contrat</label><input type="number" id="euHours"></div>
      <div><label style="font-size:11px; font-weight:700;">Email</label><input type="text" id="euEmail" disabled style="opacity:0.6"></div>
    </div>
    <div style="margin:15px 0;">
      <input type="checkbox" id="euAdmin" style="width:auto; vertical-align:middle;"> 
      <label style="font-size:12px; font-weight:700; color:#0ea5e9;">AccÃ¨s Admin</label>
    </div>
    <button class="btn" onclick="saveUser()" style="background:#0ea5e9;">Enregistrer</button>
    <button class="btn" onclick="document.getElementById('editUserPanel').classList.remove('active')" style="background:white; color:#666; border:1px solid #ccc; margin-top:10px;">Annuler</button>
  </div>

  <div class="admin-panel" id="editObjPanel" style="z-index:2100; max-width:400px; border-left:4px solid var(--primary);">
    <h3 style="margin-bottom:15px; color:var(--primary); font-size:18px;">Modifier Objectif</h3>
    <input type="hidden" id="eoId">
    <input type="text" id="eoName">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
      <input type="text" id="eoCurrent" placeholder="Actuel">
      <input type="text" id="eoTarget" placeholder="Cible">
    </div>

    <div class="options-row">
        <label class="check-label"><input type="checkbox" id="eoPrimary"> âš¡ Principal</label>
        <label class="check-label"><input type="checkbox" id="eoInverse"> ğŸ“‰ InversÃ©</label>
        <label class="check-label"><input type="checkbox" id="eoNumeric"> ğŸ”¢ Nombre</label>
        <label class="check-label"><input type="checkbox" id="eoFixed" onchange="toggleEditInputs()"> ğŸ Prime Fixe</label>
    </div>

    <div id="editTiersBlock">
        <label style="font-size:11px; font-weight:700;">PALIERS (Montants dans Pilotage)</label>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; margin-bottom:5px;">
            <input type="number" id="p1t" placeholder="% P1">
            <input type="number" id="p2t" placeholder="% P2">
            <input type="number" id="p3t" placeholder="% P3">
        </div>
    </div>
    <input type="hidden" id="p1p"><input type="hidden" id="p2p"><input type="hidden" id="p3p">
    <input type="hidden" id="eoFixedPrize">

    <div style="margin-bottom:10px; display:flex; gap:15px; margin-top:10px;">
      <span><input type="checkbox" id="eoHideTarget" style="width:auto; vertical-align:middle;"> <label style="font-size:12px;">Masquer Cible</label></span>
      <span><input type="checkbox" id="eoHideCurrent" style="width:auto; vertical-align:middle;"> <label style="font-size:12px;">Masquer Valeur</label></span>
    </div>
    <button class="btn" onclick="saveObj()">Enregistrer Modifications</button>
    <button class="btn" onclick="document.getElementById('editObjPanel').classList.remove('active')" style="background:white; color:#666; border:1px solid #ccc; margin-top:10px;">Annuler</button>
  </div>

  

  <!-- Modal: crÃ©ation/Ã©dition groupe mail -->
  <div id="mailGroupModal" class="modal-overlay" style="display:none; z-index: 4000;">
    <div class="modal-box" style="max-width:520px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px;">
        <div>
          <div id="mailGroupModalTitle" style="font-weight:950; font-size:18px;">ğŸ“§ Groupe Mail</div>
          <div class="mail-hint">CrÃ©er / modifier un groupe de destinataires.</div>
        </div>
        <button class="icon-btn" onclick="closeMailGroupModal()" aria-label="Fermer">âœ•</button>
      </div>

      <input type="hidden" id="mailGroupId">

      <label class="mail-label">Nom du groupe</label>
      <input type="text" id="mailGroupName" placeholder="Ex: Ã‰quipe du soir">

      <label class="mail-label" style="margin-top:10px;">Couleur</label>
      <input type="color" id="mailGroupColor" value="#3b82f6" class="mail-color-input">

      <label class="mail-label" style="margin-top:12px;">Membres</label>
      <div id="mailGroupMembers" class="mail-members-list"></div>

      <div style="display:flex; gap:10px; margin-top:14px;">
        <button class="btn" id="mailGroupSaveBtn" onclick="saveMailGroup()" style="flex:1;">ğŸ’¾ Enregistrer</button>
        <button class="btn" onclick="closeMailGroupModal()" style="background:#e2e8f0; color:#475569; border:1px solid #cbd5e1;">Annuler</button>
      </div>
    </div>
  </div>

<script src="assets/js/app.js"></script>
  <script src="assets/js/notifications.js"></script>
<script src="assets/js/email.js"></script>
<script src="assets/js/notifications.js"></script>

  <!-- BanniÃ¨re d'invitation notifications -->
  <div id="pushInviteBanner" class="push-invite-banner" style="display: none;">
    <div class="push-invite-content">
      <div class="push-invite-icon">ğŸ””</div>
      <div class="push-invite-text">
        <div class="push-invite-title">Active les notifications</div>
        <div class="push-invite-desc">ReÃ§ois les mises Ã  jour importantes en temps rÃ©el</div>
      </div>
    </div>
    <div class="push-invite-actions">
      <button id="pushInviteActivate" class="push-invite-btn">Activer</button>
      <button id="pushInviteDismiss" class="push-invite-close">âœ•</button>
    </div>
  </div>

</body>
</html>
